{"version":3,"file":"my.js","sources":["pages/my/my.vue","pages/my/my.vue?type=page"],"sourcesContent":["<template>\n\t<view class=\"box\">\n\t\t<!-- <button type=\"default\" open-type=\"getPhoneNumber\" @getphonenumber=\"decryptPhoneNumber\">获取手机号</button> -->\n\t\t<view class=\"userInfo\" @click=\"openChooseHead()\" v-if=\"userinfo\">\n\t\t\t<view class=\"avatar\">\n\t\t\t\t<image :src=\"userinfo.avatarUrl\" mode=\"aspectFill\"></image>\n\t\t\t</view>\n\t\t\t<view class=\"ip\">{{userinfo.nickName}}</view>\n\t\t\t<view class=\"address\">\n\t\t\t\t{{ userinfo.province || userinfo.city}}\n\t\t\t</view>\n\t\t</view>\n\t\t\n\t\t<view class=\"section\">\n\t\t\t <navigator url=\"/pages/my/collect/collectSentence?collectType=detail&name=我收藏的句子\">\n\t\t\t\t <view class=\"myCls\">\n\t\t\t\t\t <view class=\"myLeft\">\n\t\t\t\t\t\t <uni-icons size=\"30\" type=\"flag-filled\" ></uni-icons> \n\t\t\t\t\t </view>\n\t\t\t\t\t <view class=\"textCls\">\n\t\t\t\t\t\t我收藏的句子\t\t\t\t\t \n\t\t\t\t\t </view>\n\t\t\t\t\t <view class=\"myRight\">\n\t\t\t\t\t\t<uni-icons size=\"30\" type=\"forward\" ></uni-icons> \t\t\t\t\t \n\t\t\t\t\t </view>\n\t\t\t\t </view>\n\t\t\t </navigator>\n\t\t\t <navigator url=\"/pages/my/collect/collectSentence?collectType=word&name=我收藏的单词\">\n\t\t\t\t <view class=\"myCls\">\n\t\t\t\t\t <view class=\"myLeft\">\n\t\t\t\t\t\t <uni-icons size=\"30\" type=\"flag-filled\" ></uni-icons> \n\t\t\t\t\t </view>\n\t\t\t\t\t <view class=\"textCls\">\n\t\t\t\t\t\t我收藏的单词\t\t\t\t\t \n\t\t\t\t\t </view>\n\t\t\t\t\t <view class=\"myRight\">\n\t\t\t\t\t\t<uni-icons size=\"30\" type=\"forward\" ></uni-icons> \t\t\t\t\t \n\t\t\t\t\t </view>\n\t\t\t\t </view>\n\t\t\t </navigator>\n\t\t\t <view class=\"myCls\">\n\t\t\t\t <view class=\"myLeft\">\n\t\t\t\t\t <uni-icons size=\"30\" type=\"flag-filled\" ></uni-icons> \n\t\t\t\t </view>\n\t\t\t\t <view class=\"textCls\">\n\t\t\t\t\t我已学习的课程\t\t\t\t\t \n\t\t\t\t </view>\n\t\t\t\t <view class=\"myRight\">\n\t\t\t\t\t<uni-icons size=\"30\" type=\"forward\" ></uni-icons> \t\t\t\t\t \n\t\t\t\t </view>\n\t\t\t </view>\n\t\t</view> \n\t\t<uni-popup ref=\"myHeadPopup\" :is-mask-click=\"true\">\n\t\t\t<get-wx-user-info \n\t\t\t@chooseDone=\"onChooseDone\" \n\t\t\tref=\"myHeadBar\"></get-wx-user-info>\n\t\t</uni-popup> \n\t</view>\n</template>\n\n<script setup> \nimport {ref} from \"vue\";\nimport {apiGetWechatMiniSessionKey} from \"@/common/api/apis.js\"\n\nconst myHeadPopup = ref(null);\nconst userinfo = ref(uni.getStorageSync(\"myUser\") || {\"nickName\":\"未登录\",\"avatarUrl\":\"/static/images/user/noLogin.png\"})\nlet userHeadAndName = null;\n\nfunction onChooseDone(e){ \n\tuserHeadAndName = e;\n\tmyHeadPopup.value.close();\n\tuserLogin();\n}\n\nfunction openChooseHead(){\n\tmyHeadPopup.value.open();\n}\n\nfunction userLogin(){  \n\tuni.showLoading({\n\t\t\"title\":\"登录中...\"\n\t});\n\tsetTimeout(()=>{\n\t\tuni.hideLoading();\n\t},10*1000);\n\t//获取用户的基本信息，昵称等\n\tuni.login({\n\t    provider: 'weixin',\n\t    success: function (loginRes) { \n\t        // 登录成功\n\t        uni.getUserInfo({\n\t            provider: 'weixin',\n\t            success: function(info) {\n\t                // 获取用户信息成功, info.authResult保存用户信息 \n\t\t\t\t\tuserinfo.value = info.userInfo;\n\t\t\t\t\tuserinfo.value.avatarUrl = userHeadAndName.avatarUrl;\n\t\t\t\t\tuserinfo.value.nickName = userHeadAndName.userNickName;\n\t\t\t\t\tconsole.log(\"个人信息\", userinfo.value);\n\t\t\t\t\t//存储个人信息到缓存\n\t\t\t\t\tuni.setStorageSync(\"myUser\", userinfo.value);\n\t\t\t\t\t//获取用户的openId\n\t\t\t\t\tgetUserOpenId();\n\t            }\n\t        })\n\t    },\n\t    fail: function (err) {\n\t        // 登录授权失败\n\t        // err.code是错误码\n\t    }\n\t});\n\t\n\t\n}\n\n// 获取用户的openid\nfunction getUserOpenId(){\n\t//获取token和openid\n\tuni.login({\n\t\t\"provider\": \"weixin\",\n\t\t\"onlyAuthorize\": true, // 微信登录仅请求授权认证\n\t\tsuccess: function(event){\n\t\t\tconst {code} = event;\n\t\t\tgetWechatMiniSessionKey(code); \n\t\t},\n\t\tfail: function (err) {\n\t        // 登录授权失败\n\t        // err.code是错误码 \n\t    }\n\t})\n}\n\nconst getWechatMiniSessionKey =async(code)=>{ \n\tlet res =await apiGetWechatMiniSessionKey({\n\t\tcode:code,\n\t\twechatUser:uni.getStorageSync(\"myUser\")\n\t}); \n\t\n\tlet sessionKey = res.data.session_key;\n\tlet openid = res.data.openid;\n\tconsole.log(\"获取到的sessionKey->\", sessionKey);\n\tconsole.log(\"获取到的openid->\", openid);\n\t\n\tuserinfo.value.sessionKey = sessionKey;\n\tuserinfo.value.openid = openid;\n\tconsole.log(\"获取到的userinfo->\", userinfo);\n\t\n\t\n\tuni.setStorageSync(\"myUser\", userinfo.value);\n\tuni.hideLoading();\n\t\n\t// if(type == \"getPhoneNumber\"){\n\t// \tlet phone_encryptedData = getPhoneRes.detail.encryptedData //用于解密\n\t// \tlet phone_iv = getPhoneRes.detail.iv // 用于解密\n\t// \tconsole.log(getPhoneRes, \"获取手机号需要的参数\");\n\t// \tlet pc = new WXBizDataCrypt('wx87cb4cd6a4321f5b', sessionKey);\n\t// \tlet data = pc.decryptData(this.phone_encryptedData, phone_iv);\n\t// \tconsole.log(data);\n\t// \tif (data.phoneNumber != '') {\n\t// \t\t// this.phone = data.phoneNumber\n\t// \t} \n\t// }\n}\n \n\n\nfunction decryptPhoneNumber(res){\n\tuserLogin(\"getPhoneNumber\", res);\n}\n\n</script>\n\n<style lang=\"scss\" scoped>\n\t.userInfo{\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tflex-direction: column;\t\t\n\t\tpadding:50rpx 0;\n\t\t.avatar{\n\t\t\twidth: 160rpx;\n\t\t\theight: 160rpx;\n\t\t\tborder-radius: 50%;\n\t\t\toverflow: hidden;\n\t\t\timage{\n\t\t\t\twidth: 100%;\n\t\t\t\theight: 100%;\n\t\t\t}\n\t\t}\n\t\t.ip{\n\t\t\tfont-size: 44rpx;\n\t\t\tcolor:#333;\n\t\t\tpadding:20rpx 0 5rpx;\n\t\t}\n\t\t.address{\n\t\t\tfont-size: 28rpx;\n\t\t\tcolor:#aaa;\n\t\t}\n\t}\n\t\n\t.section{\n\t\twidth: 690rpx;\n\t\tmargin:10rpx auto;  \n\t\tfont-size: 25rpx;\n\t\t.myCls{\n\t\t\tborder-radius: 10rpx; \n\t\t\tbox-shadow: 0 0 30rpx rgba(0,0,0,0.05);\n\t\t\theight: 80rpx;  \n\t\t\tjustify-content: left;\n\t\t\talign-items: center;\n\t\t\tdisplay: flex; \n\t\t\tjustify-content: space-between;\n\t\t\tmargin: 20rpx 0rpx;\n\t\t\tpadding: 10rpx;\n\t\t\t.myLeft{\n\t\t\t\twidth: 50rpx; \n\t\t\t}\n\t\t\t.textCls{\n\t\t\t\tpadding-left: 20rpx; \n\t\t\t\tflex: 1;\n\t\t\t\twidth: 0; \n\t\t\t}\n\t\t\t.myRight{\n\t\t\t\tdisplay: flex;\n\t\t\t\tposition: relative;\n\t\t\t\tright: 0rpx;\n\t\t\t\twidth: 50rpx;\n\t\t\t\theight: 100%; \n\t\t\t\talign-items: center;\n\t\t\t}\n\t\t\t:deep(){\n\t\t\t\t.uni-icons{\n\t\t\t\t\tcolor:$brand-theme-color !important;\n\t\t\t\t}\n\t\t\t}\t\n\t\t}\n\t}\n</style>\n\n","import MiniProgramPage from '/Users/yxy/work/java/demo/yxy-springboot-eng-sentence/yxy-springboot-eng-sentence/my-eng/pages/my/my.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","uni","apiGetWechatMiniSessionKey"],"mappings":";;;;;;;;;;;;;;;;;;AAgEA,UAAM,cAAcA,cAAAA,IAAI,IAAI;AAC5B,UAAM,WAAWA,cAAG,IAACC,oBAAI,eAAe,QAAQ,KAAK,EAAC,YAAW,OAAM,aAAY,kCAAiC,CAAC;AACrH,QAAI,kBAAkB;AAEtB,aAAS,aAAa,GAAE;AACvB,wBAAkB;AAClB,kBAAY,MAAM;AAClB;IACD;AAEA,aAAS,iBAAgB;AACxB,kBAAY,MAAM;IACnB;AAEA,aAAS,YAAW;AACnBA,oBAAAA,MAAI,YAAY;AAAA,QACf,SAAQ;AAAA,MACV,CAAE;AACD,iBAAW,MAAI;AACdA,sBAAG,MAAC,YAAW;AAAA,MACjB,GAAG,KAAG,GAAI;AAETA,oBAAAA,MAAI,MAAM;AAAA,QACN,UAAU;AAAA,QACV,SAAS,SAAU,UAAU;AAEzBA,wBAAAA,MAAI,YAAY;AAAA,YACZ,UAAU;AAAA,YACV,SAAS,SAAS,MAAM;AAEhC,uBAAS,QAAQ,KAAK;AACtB,uBAAS,MAAM,YAAY,gBAAgB;AAC3C,uBAAS,MAAM,WAAW,gBAAgB;AAC1CA,4BAAY,MAAA,MAAA,OAAA,yBAAA,QAAQ,SAAS,KAAK;AAElCA,4BAAAA,MAAI,eAAe,UAAU,SAAS,KAAK;AAE3C;YACS;AAAA,UACd,CAAU;AAAA,QACJ;AAAA,QACD,MAAM,SAAU,KAAK;AAAA,QAGpB;AAAA,MACN,CAAE;AAAA,IAGF;AAGA,aAAS,gBAAe;AAEvBA,oBAAAA,MAAI,MAAM;AAAA,QACT,YAAY;AAAA,QACZ,iBAAiB;AAAA;AAAA,QACjB,SAAS,SAAS,OAAM;AACvB,gBAAM,EAAC,KAAI,IAAI;AACf,kCAAwB,IAAI;AAAA,QAC5B;AAAA,QACD,MAAM,SAAU,KAAK;AAAA,QAGjB;AAAA,MACN,CAAE;AAAA,IACF;AAEA,UAAM,0BAAyB,OAAM,SAAO;AAC3C,UAAI,MAAK,MAAMC,2CAA2B;AAAA,QACzC;AAAA,QACA,YAAWD,cAAAA,MAAI,eAAe,QAAQ;AAAA,MACxC,CAAE;AAED,UAAI,aAAa,IAAI,KAAK;AAC1B,UAAI,SAAS,IAAI,KAAK;AACtBA,oBAAY,MAAA,MAAA,OAAA,0BAAA,oBAAoB,UAAU;AAC1CA,oBAAA,MAAA,MAAA,OAAA,0BAAY,gBAAgB,MAAM;AAElC,eAAS,MAAM,aAAa;AAC5B,eAAS,MAAM,SAAS;AACxBA,oBAAY,MAAA,MAAA,OAAA,0BAAA,kBAAkB,QAAQ;AAGtCA,oBAAAA,MAAI,eAAe,UAAU,SAAS,KAAK;AAC3CA,oBAAG,MAAC,YAAW;AAAA,IAahB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AChKA,GAAG,WAAW,eAAe;"}