{"version":3,"names":["userinfo","common_vendor","ref","index","getStorageSync","__f__","userLogin","type","getPhoneRes","login","provider","success","loginRes","getUserInfo","info","value","userInfo","setStorageSync","fail","err","event","code","getWechatMiniSessionKey","_ref","_asyncToGenerator2","_regeneratorRuntime2","mark","_callee","res","sessionKey","phone_iv","pc","data","wrap","_callee$","_context","prev","next","common_api_apis","apiGetWechatMiniSessionKey","sent","session_key","detail","encryptedData","iv","WXBizDataCrypt","decryptData","_this","phone_encryptedData","phoneNumber","stop","_x","_x2","_x3","apply","arguments","decryptPhoneNumber","wx","createPage","MiniProgramPage"],"sources":["my.vue","my.vue?type=page"],"sourcesContent":["<template>\n\t<view class=\"box\">\n\t\t<button type=\"default\" open-type=\"getPhoneNumber\" @getphonenumber=\"decryptPhoneNumber\">获取手机号</button>\n\t\t<view class=\"userInfo\" @click=\"userLogin()\" v-if=\"userinfo\">\n\t\t\t<view class=\"avatar\">\n\t\t\t\t<image :src=\"userinfo.avatarUrl\" mode=\"aspectFill\"></image>\n\t\t\t</view>\n\t\t\t<view class=\"ip\">{{userinfo.nickName}}</view>\n\t\t\t<view class=\"address\">\n\t\t\t\t{{ userinfo.province || userinfo.city}}\n\t\t\t</view>\n\t\t</view>\n\t\t\n\t\t<view class=\"section\">\n\t\t\t <navigator url=\"/pages/my/collect/collectSentence\">\n\t\t\t\t <view class=\"myCls\">\n\t\t\t\t\t <view class=\"myLeft\">\n\t\t\t\t\t\t <uni-icons size=\"30\" type=\"flag-filled\" ></uni-icons> \n\t\t\t\t\t </view>\n\t\t\t\t\t <view class=\"textCls\">\n\t\t\t\t\t\t我收藏的句子\t\t\t\t\t \n\t\t\t\t\t </view>\n\t\t\t\t\t <view class=\"myRight\">\n\t\t\t\t\t\t<uni-icons size=\"30\" type=\"forward\" ></uni-icons> \t\t\t\t\t \n\t\t\t\t\t </view>\n\t\t\t\t </view>\n\t\t\t </navigator>\n\t\t\t <navigator url=\"/pages/my/collect/collectWord\">\n\t\t\t\t <view class=\"myCls\">\n\t\t\t\t\t <view class=\"myLeft\">\n\t\t\t\t\t\t <uni-icons size=\"30\" type=\"flag-filled\" ></uni-icons> \n\t\t\t\t\t </view>\n\t\t\t\t\t <view class=\"textCls\">\n\t\t\t\t\t\t我收藏的单词\t\t\t\t\t \n\t\t\t\t\t </view>\n\t\t\t\t\t <view class=\"myRight\">\n\t\t\t\t\t\t<uni-icons size=\"30\" type=\"forward\" ></uni-icons> \t\t\t\t\t \n\t\t\t\t\t </view>\n\t\t\t\t </view>\n\t\t\t </navigator>\n\t\t\t <view class=\"myCls\">\n\t\t\t\t <view class=\"myLeft\">\n\t\t\t\t\t <uni-icons size=\"30\" type=\"flag-filled\" ></uni-icons> \n\t\t\t\t </view>\n\t\t\t\t <view class=\"textCls\">\n\t\t\t\t\t我已学习的课程\t\t\t\t\t \n\t\t\t\t </view>\n\t\t\t\t <view class=\"myRight\">\n\t\t\t\t\t<uni-icons size=\"30\" type=\"forward\" ></uni-icons> \t\t\t\t\t \n\t\t\t\t </view>\n\t\t\t </view>\n\t\t</view> \n\t</view>\n</template>\n\n<script setup> \nimport {ref} from \"vue\";\nimport {apiGetWechatMiniSessionKey} from \"@/common/api/apis.js\"\n\nconst userinfo = ref(uni.getStorageSync(\"myUser\") || {\"nickName\":\"未登录\",\"avatarUrl\":\"/static/images/user/noLogin.png\"})\nconsole.log(\"userinfo\",userinfo)\nfunction userLogin(type, getPhoneRes){\n\tconsole.log(\"正在登录\");\n\t//获取用户的基本信息，昵称等\n\tuni.login({\n\t    provider: 'weixin',\n\t    success: function (loginRes) {\n\t        // 登录成功\n\t        uni.getUserInfo({\n\t            provider: 'weixin',\n\t            success: function(info) {\n\t                // 获取用户信息成功, info.authResult保存用户信息\n\t\t\t\t\tconsole.log(\"个人信息\", info);\n\t\t\t\t\tuserinfo.value = info.userInfo;\n\t\t\t\t\tuni.setStorageSync(\"myUser\", userinfo.value);\n\t            }\n\t        })\n\t    },\n\t    fail: function (err) {\n\t        // 登录授权失败\n\t        // err.code是错误码\n\t    }\n\t});\n\t\n\t//获取token和openid\n\tuni.login({\n\t\t\"provider\": \"weixin\",\n\t\t\"onlyAuthorize\": true, // 微信登录仅请求授权认证\n\t\tsuccess: function(event){\n\t\t\tconst {code} = event;\n\t\t\tgetWechatMiniSessionKey(code,type,getPhoneRes); \n\t\t},\n\t\tfail: function (err) {\n\t        // 登录授权失败\n\t        // err.code是错误码\n\t    }\n\t})\n}\n\nconst getWechatMiniSessionKey =async(code,type,getPhoneRes)=>{\n\tlet res =await apiGetWechatMiniSessionKey({\n\t\tcode:code\n\t}); \n\tconsole.log(\"用户登录结束\",res);\n\tlet sessionKey = res.session_key;\n\t\n\tconsole.log(\"类型\",type);\n\tif(type == \"getPhoneNumber\"){\n\t\tlet phone_encryptedData = getPhoneRes.detail.encryptedData //用于解密\n\t\tlet phone_iv = getPhoneRes.detail.iv // 用于解密\n\t\tconsole.log(getPhoneRes, \"获取手机号需要的参数\");\n\t\tlet pc = new WXBizDataCrypt('wx87cb4cd6a4321f5b', sessionKey);\n\t\tlet data = pc.decryptData(this.phone_encryptedData, phone_iv);\n\t\tconsole.log(data);\n\t\tif (data.phoneNumber != '') {\n\t\t\t// this.phone = data.phoneNumber\n\t\t} \n\t}\n}\n\nfunction decryptPhoneNumber(res){\n\tuserLogin(\"getPhoneNumber\", res);\n}\n\n</script>\n\n<style lang=\"scss\" scoped>\n\t.userInfo{\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tflex-direction: column;\t\t\n\t\tpadding:50rpx 0;\n\t\t.avatar{\n\t\t\twidth: 160rpx;\n\t\t\theight: 160rpx;\n\t\t\tborder-radius: 50%;\n\t\t\toverflow: hidden;\n\t\t\timage{\n\t\t\t\twidth: 100%;\n\t\t\t\theight: 100%;\n\t\t\t}\n\t\t}\n\t\t.ip{\n\t\t\tfont-size: 44rpx;\n\t\t\tcolor:#333;\n\t\t\tpadding:20rpx 0 5rpx;\n\t\t}\n\t\t.address{\n\t\t\tfont-size: 28rpx;\n\t\t\tcolor:#aaa;\n\t\t}\n\t}\n\t\n\t.section{\n\t\twidth: 690rpx;\n\t\tmargin:10rpx auto;  \n\t\tfont-size: 25rpx;\n\t\t.myCls{\n\t\t\tborder-radius: 10rpx; \n\t\t\tbox-shadow: 0 0 30rpx rgba(0,0,0,0.05);\n\t\t\theight: 80rpx;  \n\t\t\tjustify-content: left;\n\t\t\talign-items: center;\n\t\t\tdisplay: flex; \n\t\t\tjustify-content: space-between;\n\t\t\tmargin: 20rpx 0rpx;\n\t\t\tpadding: 10rpx;\n\t\t\t.myLeft{\n\t\t\t\twidth: 50rpx; \n\t\t\t}\n\t\t\t.textCls{\n\t\t\t\tpadding-left: 20rpx; \n\t\t\t\tflex: 1;\n\t\t\t\twidth: 0; \n\t\t\t}\n\t\t\t.myRight{\n\t\t\t\tdisplay: flex;\n\t\t\t\tposition: relative;\n\t\t\t\tright: 0rpx;\n\t\t\t\twidth: 50rpx;\n\t\t\t\theight: 100%; \n\t\t\t\talign-items: center;\n\t\t\t}\n\t\t\t:deep(){\n\t\t\t\t.uni-icons{\n\t\t\t\t\tcolor:$brand-theme-color !important;\n\t\t\t\t}\n\t\t\t}\t\n\t\t}\n\t}\n</style>\n\n","import MiniProgramPage from '/Users/yxy/work/前端/uniapp/my-eng/pages/my/my.vue'\nwx.createPage(MiniProgramPage)"],"mappings":"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","ignoreList":[]}