{"version":3,"file":"my-firework.js","sources":["components/my-firework/my-firework.vue","/Users/yxy/work/前端/uniapp/my-preschool/components/my-firework/my-firework.vue?type=component"],"sourcesContent":["<template>\n  <view class=\"container\"> \n    <canvas \n      canvas-id=\"fireworksCanvas\" \n      id=\"fireworksCanvas\" \n      class=\"canvas\"\n      :style=\"{width: canvasWidth + 'px', height: canvasHeight + 'px'}\"\n    ></canvas>\n  </view>\n</template>\n\n<script setup>\nimport { ref, onMounted, onUnmounted, getCurrentInstance } from 'vue'\n\nconst canvasWidth = ref(300)\nconst canvasHeight = ref(500)\nconst particles = ref([])\nconst animationTimer = ref(null)\nconst startTime = ref(0)\nconst duration = 5000 // 5秒\n\n// 初始化粒子\nconst initParticles = () => {\n  const count = 50 // 适当减少粒子数量以提高性能\n  particles.value = []\n  \n  for (let i = 0; i < count; i++) {\n    particles.value.push({\n      x: Math.random() * canvasWidth.value,\n      y: -10, // 从屏幕上方开始\n      vx: Math.random() * 2 - 1, // 水平速度\n      vy: Math.random() * 2 + 2, // 垂直速度\n      size: Math.random() * 3 + 2,\n      color: getRandomColor(),\n      alpha: 1,\n      decay: Math.random() * 0.02 + 0.01 // 透明度衰减\n    })\n  }\n}\n\n// 生成随机颜色\nconst getRandomColor = () => {\n  const colors = [\n    '#FF5252', '#FF4081', '#E040FB', '#7C4DFF', \n    '#536DFE', '#448AFF', '#40C4FF', '#18FFFF',\n    '#64FFDA', '#69F0AE', '#B2FF59', '#EEFF41', \n    '#FFFF00', '#FFD740', '#FFAB40', '#FF6E40'\n  ]\n  return colors[Math.floor(Math.random() * colors.length)]\n}\n\n// 绘制粒子\nconst drawParticles = () => {\n  const ctx = uni.createCanvasContext('fireworksCanvas', getCurrentInstance())\n  ctx.clearRect(0, 0, canvasWidth.value, canvasHeight.value)\n  \n  particles.value.forEach(particle => {\n    ctx.beginPath()\n    ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2)\n    ctx.setFillStyle(particle.color)\n    ctx.setGlobalAlpha(particle.alpha)\n    ctx.fill()\n  })\n  \n  ctx.draw()\n}\n\n// 更新粒子位置\nconst updateParticles = () => {\n  const currentTime = Date.now()\n  const elapsed = currentTime - startTime.value\n  \n  if (elapsed >= duration) {\n    // 动画结束\n    stopAnimation()\n    return false\n  }\n  \n  particles.value.forEach(particle => {\n    particle.x += particle.vx\n    particle.y += particle.vy\n    particle.alpha -= particle.decay\n    \n    // 给粒子一些随机运动\n    particle.vx += (Math.random() - 0.5) * 0.2\n    particle.vy += Math.random() * 0.1\n    \n    // 重置超出屏幕的粒子\n    if (particle.y > canvasHeight.value || particle.alpha <= 0) {\n      resetParticle(particle)\n    }\n  })\n  \n  return true\n}\n\n// 重置粒子\nconst resetParticle = (particle) => {\n  particle.x = Math.random() * canvasWidth.value\n  particle.y = -10\n  particle.alpha = 1\n  particle.vx = Math.random() * 2 - 1\n  particle.vy = Math.random() * 2 + 2\n}\n\n// 动画循环\nconst animate = () => {\n  const shouldContinue = updateParticles()\n  drawParticles()\n  console.log(\"进来了 大哥\")\n  if (shouldContinue) {\n    animationTimer.value = setTimeout(() => {\n      animate()\n    }, 16) // 约60fps\n  }\n}\n\n// 停止动画\nconst stopAnimation = () => {\n  if (animationTimer.value) {\n    clearTimeout(animationTimer.value)\n    animationTimer.value = null\n  }\n    const ctx = uni.createCanvasContext('fireworksCanvas', getCurrentInstance())\n    ctx.clearRect(0, 0, canvasWidth.value, canvasHeight.value)\n    ctx.draw()\n}\n\n// 开始动画\nconst startAnimation = () => {\n  startTime.value = Date.now()\n  initParticles()\n  animate()\n}\n\nonMounted(() => {\n  // 获取屏幕尺寸\n  uni.getSystemInfo({\n    success: (res) => {\n      canvasWidth.value = res.windowWidth\n      canvasHeight.value = res.windowHeight * 0.8 // 使用屏幕高度的80%\n      startAnimation() // 确保在获取尺寸后开始动画\n    }\n  })\n})\n\nonUnmounted(() => {\n  stopAnimation()\n})\n</script>\n\n<style>\n.container {\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  pointer-events: none; /* 允许点击穿透 */\n  z-index: 9999; \n}\n\n.canvas {\n  width: 100%;\n  height: 100%;\n}\n</style>","import Component from '/Users/yxy/work/前端/uniapp/my-preschool/components/my-firework/my-firework.vue'\nwx.createComponent(Component)"],"names":["ref","uni","getCurrentInstance","onMounted","onUnmounted","Component"],"mappings":"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"}