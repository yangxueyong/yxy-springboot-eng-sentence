{"version":3,"file":"firework.js","sources":["common/utils/firework.js"],"sourcesContent":["import { ref, onMounted, onUnmounted } from 'vue'\n\nexport const canvasWidth = ref(300)\nexport const canvasHeight = ref(500)\nexport const showCanvas = ref(false);\nconst particles = ref([])\nconst animationTimer = ref(null)\nconst startTime = ref(0)\nconst duration = 5000 // 1个小时\nlet ctx = null;\n// 初始化粒子\nconst initParticles = () => {\n  const count = 100 // 适当减少粒子数量以提高性能\n  particles.value = []\n  \n  for (let i = 0; i < count; i++) {\n    particles.value.push({\n      x: Math.random() * canvasWidth.value,\n      y: -10, // 从屏幕上方开始\n      vx: Math.random() * 2 - 1, // 水平速度\n      vy: Math.random() * 2 + 2, // 垂直速度\n      size: Math.random() * 3 + 2,\n      color: getRandomColor(),\n      alpha: 1,\n      decay: Math.random() * 0.02 + 0.01 // 透明度衰减\n    })\n  }\n}\n\n// 生成随机颜色\nconst getRandomColor = () => {\n  const colors = [\n    '#FF5252', '#FF4081', '#E040FB', '#7C4DFF', \n    '#536DFE', '#448AFF', '#40C4FF', '#18FFFF',\n    '#64FFDA', '#69F0AE', '#B2FF59', '#EEFF41', \n    '#FFFF00', '#FFD740', '#FFAB40', '#FF6E40'\n  ]\n  return colors[Math.floor(Math.random() * colors.length)]\n}\n\n// 绘制粒子\nconst drawParticles = () => {\n  if(ctx == null){\n\tctx = uni.createCanvasContext('fireworksCanvas', this);\n  }\n  \n  ctx.clearRect(0, 0, canvasWidth.value, canvasHeight.value)\n  \n  particles.value.forEach(particle => {\n    ctx.beginPath()\n    ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2)\n    ctx.setFillStyle(particle.color)\n    ctx.setGlobalAlpha(particle.alpha)\n    ctx.fill()\n  })\n  \n  ctx.draw()\n}\n\n// 更新粒子位置\nconst updateParticles = () => {\n  const currentTime = Date.now()\n  const elapsed = currentTime - startTime.value\n  \n  if (elapsed >= duration) {  \n    // 动画结束\n    stopAnimation()\n    return false\n  }\n  \n  particles.value.forEach(particle => {\n    particle.x += particle.vx\n    particle.y += particle.vy\n    particle.alpha -= particle.decay\n    \n    // 给粒子一些随机运动\n    particle.vx += (Math.random() - 0.5) * 0.2\n    particle.vy += Math.random() * 0.1\n    \n    // 重置超出屏幕的粒子\n    if (particle.y > canvasHeight.value || particle.alpha <= 0) {\n      resetParticle(particle)\n    }\n  })\n  \n  return true\n}\n\n// 重置粒子\nconst resetParticle = (particle) => {\n  particle.x = Math.random() * canvasWidth.value\n  particle.y = -10\n  particle.alpha = 1\n  particle.vx = Math.random() * 2 - 1\n  particle.vy = Math.random() * 2 + 2\n}\n\n// 动画循环\nconst animate = () => {\n  const shouldContinue = updateParticles()\n  drawParticles()\n  if (shouldContinue) {\n    animationTimer.value = setTimeout(() => {\n      animate()\n    }, 16) // 约60fps\n  }\n}\n\n// 停止动画\nconst stopAnimation = () => {\n  if (animationTimer.value) {\n    clearTimeout(animationTimer.value)\n    animationTimer.value = null\n  }\n  showCanvas.value = false;\n  if(ctx != null){\n\t  console.log(\"清理画布-->\")\n\t  // // ctx.clearRect()\n\t  // particles.value.forEach(particle => {\n\t  //   ctx.beginPath()\n\t  //   ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2)\n\t  //   ctx.setFillStyle(\"#ffffff\")\n\t  //   ctx.setGlobalAlpha(particle.alpha)\n\t  //   ctx.fill()\n\t  // })\n\t  ctx.clearRect(0, 0, canvasWidth.value, canvasHeight.value);\n\t  // // ctx = uni.createCanvasContext('fireworksCanvas', this);\n\t  // ctx.setFillStyle('#FFFFFF'); // 白色背景\n\t  // ctx.fillRect(0, 0, canvasWidth.value, canvasHeight.value);\n\t  // ctx.draw();\n\t  ctx.draw(); \n  }\n}\n\n// 开始动画\nconst startAnimation = () => {\n  startTime.value = Date.now()\n  initParticles()\n  animate()\n}\n\n// 开始动画\nexport const startFirework =() => {\n\tshowCanvas.value = true;\n  // 获取屏幕尺寸\n  uni.getSystemInfo({\n    success: (res) => {\n      canvasWidth.value = res.windowWidth\n      canvasHeight.value = res.windowHeight * 0.8 // 使用屏幕高度的80%\n      startAnimation() // 确保在获取尺寸后开始动画\n    }\n  })\n}\n\nexport const endFirework = () => { \n  stopAnimation()\n}"],"names":["ref","uni","this"],"mappings":"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"}